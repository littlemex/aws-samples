# Amazon DocumentDB スパイク対策 - リソース問題ソリューション

## 1.1 インスタンスタイプ変更（T系からR系へ）

T系インスタンスはCPUクレジットを消費するバースト可能なインスタンスです。本番環境では安定したパフォーマンスを提供するR5やR6gなどのインスタンスタイプを使用することが推奨されます。インスタンスタイプの変更にはダウンタイムが発生する可能性があることに注意してください。

## 1.2 読み取り負荷分散（レプリカ追加）

読み取りクエリをレプリカに分散させることでプライマリノードの負荷を軽減できます。これには、レプリカの追加とアプリケーションの読み取りルーティング設定が必要です。

## 1.3 書き込み最適化（バッチ処理見直し）

書き込み処理をバッチ化して効率化を図ります。小さな書き込みをまとめることや、書き込みタイミングを分散させることで、システムの負荷を軽減できます。

## 1.4 クエリ最適化（インデックス見直し）

クエリパターンに基づいて適切なインデックスを作成します。`explain()`を使用してクエリプランを分析し、必要なインデックスを作成することで、クエリのパフォーマンスを向上させることができます。

## 1.5 バッチ処理最適化（時間帯分散）

バッチ処理を負荷の少ない時間帯に実行することで、システムの負荷を分散させます。バッチ処理のスケジュール変更や処理の分割を行うことで、リソースの効率的な利用が可能になります。

## 1.6 定期処理見直し

定期的に実行される処理の最適化を行います。処理頻度の見直しや処理内容の効率化により、システムリソースの使用を最適化できます。

## 1.7 アクセスパターン分析

不規則なスパイクの原因となるアクセスパターンを特定します。アプリケーションログ分析やCloudWatchメトリクスの詳細分析を通じて、問題の根本原因を特定し、適切な対策を講じることができます。
