{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.19", "generated_at": "2025-10-19T10:22:11.041419Z", "invocation_id": "50205043-70e8-4174-83f0-de59d4622e09", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-19T10:22:10.842952Z", "completed_at": "2025-10-19T10:22:10.846346Z"}, {"name": "execute", "started_at": "2025-10-19T10:22:10.848689Z", "completed_at": "2025-10-19T10:22:10.952843Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.13392877578735352, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.multitenant_analytics.zero_etl_all_users", "compiled": true, "compiled_code": "-- Zero-ETL compatible all users model\n-- Modified for local PostgreSQL environment (no cross-database references)\n\n\n\nWITH tenant_users AS (\n    SELECT \n        'tenant_a'::varchar(50) as tenant_id,\n        user_id,\n        email,\n        first_name,\n        last_name,\n        registration_date,\n        last_login_date,\n        account_status,\n        subscription_tier,\n        created_at,\n        updated_at\n    FROM tenant_a.users\n    \n    UNION ALL\n    \n    SELECT \n        'tenant_b'::varchar(50) as tenant_id,\n        user_id,\n        email,\n        first_name,\n        last_name,\n        registration_date,\n        last_login_date,\n        account_status,\n        subscription_tier,\n        created_at,\n        updated_at\n    FROM tenant_b.users\n    \n    UNION ALL\n    \n    SELECT \n        'tenant_c'::varchar(50) as tenant_id,\n        user_id,\n        email,\n        first_name,\n        last_name,\n        registration_date,\n        last_login_date,\n        account_status,\n        subscription_tier,\n        created_at,\n        updated_at\n    FROM tenant_c.users\n)\n\nSELECT * FROM tenant_users\nORDER BY tenant_id, user_id", "relation_name": "\"multitenant_analytics\".\"public_analytics\".\"zero_etl_all_users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-19T10:22:10.839706Z", "completed_at": "2025-10-19T10:22:10.874725Z"}, {"name": "execute", "started_at": "2025-10-19T10:22:10.875378Z", "completed_at": "2025-10-19T10:22:10.956535Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.13962507247924805, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.multitenant_analytics.stg_all_tenants__users", "compiled": true, "compiled_code": "\n\n-- Dynamic staging model for ALL tenant users from Aurora zero-ETL replication\n-- This model automatically detects and processes ALL tenant schemas using INFORMATION_SCHEMA\n-- No manual configuration needed - supports unlimited tenants dynamically\n\n\n\nwith\n\ntenant_a_data as (\n    select\n        user_id,\n        lower(trim(email)) as email,\n        trim(first_name) as first_name,\n        trim(last_name) as last_name,\n        registration_date,\n        last_login_date,\n        upper(trim(account_status)) as account_status,\n        lower(trim(subscription_tier)) as subscription_tier,\n        created_at,\n        updated_at,\n        'tenant_a' as tenant_id,\n        current_timestamp as dbt_loaded_at\n    from tenant_a.users\n    where email is not null\n        and user_id is not null\n),\n\ntenant_b_data as (\n    select\n        user_id,\n        lower(trim(email)) as email,\n        trim(first_name) as first_name,\n        trim(last_name) as last_name,\n        registration_date,\n        last_login_date,\n        upper(trim(account_status)) as account_status,\n        lower(trim(subscription_tier)) as subscription_tier,\n        created_at,\n        updated_at,\n        'tenant_b' as tenant_id,\n        current_timestamp as dbt_loaded_at\n    from tenant_b.users\n    where email is not null\n        and user_id is not null\n),\n\ntenant_c_data as (\n    select\n        user_id,\n        lower(trim(email)) as email,\n        trim(first_name) as first_name,\n        trim(last_name) as last_name,\n        registration_date,\n        last_login_date,\n        upper(trim(account_status)) as account_status,\n        lower(trim(subscription_tier)) as subscription_tier,\n        created_at,\n        updated_at,\n        'tenant_c' as tenant_id,\n        current_timestamp as dbt_loaded_at\n    from tenant_c.users\n    where email is not null\n        and user_id is not null\n)\n\n\nselect * from tenant_a_data\n\nunion all\nselect * from tenant_b_data\n\nunion all\nselect * from tenant_c_data\n", "relation_name": "\"multitenant_analytics\".\"public\".\"stg_all_tenants__users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-19T10:22:10.822562Z", "completed_at": "2025-10-19T10:22:10.879879Z"}, {"name": "execute", "started_at": "2025-10-19T10:22:10.881612Z", "completed_at": "2025-10-19T10:22:10.958092Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1414353847503662, "adapter_response": {"_message": "SELECT 15", "code": "SELECT", "rows_affected": 15}, "message": "SELECT 15", "failures": null, "unique_id": "model.multitenant_analytics.all_users", "compiled": true, "compiled_code": "-- \u52d5\u7684\u306b\u5168\u30c6\u30ca\u30f3\u30c8\u306e\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u7d71\u5408\n-- sources.yml \u4e0d\u8981\u3067\u5b8c\u5168\u52d5\u7684\n\n\n\n\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n    \n    \n  \n  \n  \n    \n    \n      SELECT \n        'tenant_a' as tenant_id,\n        user_id,\n    email,\n    first_name,\n    last_name,\n    registration_date,\n    last_login_date,\n    account_status,\n    subscription_tier,\n    created_at,\n    updated_at\n      FROM tenant_a.users\n      \n      UNION ALL\n      \n    \n      SELECT \n        'tenant_b' as tenant_id,\n        user_id,\n    email,\n    first_name,\n    last_name,\n    registration_date,\n    last_login_date,\n    account_status,\n    subscription_tier,\n    created_at,\n    updated_at\n      FROM tenant_b.users\n      \n      UNION ALL\n      \n    \n      SELECT \n        'tenant_c' as tenant_id,\n        user_id,\n    email,\n    first_name,\n    last_name,\n    registration_date,\n    last_login_date,\n    account_status,\n    subscription_tier,\n    created_at,\n    updated_at\n      FROM tenant_c.users\n      \n    \n  \n  \n", "relation_name": "\"multitenant_analytics\".\"public\".\"all_users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-19T10:22:10.965243Z", "completed_at": "2025-10-19T10:22:10.967795Z"}, {"name": "execute", "started_at": "2025-10-19T10:22:10.968391Z", "completed_at": "2025-10-19T10:22:10.995252Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.031401872634887695, "adapter_response": {"_message": "SELECT 15", "code": "SELECT", "rows_affected": 15}, "message": "SELECT 15", "failures": null, "unique_id": "model.multitenant_analytics.dim_users", "compiled": true, "compiled_code": "\n\n-- Dimension table combining all tenant users for cross-tenant analytics\n-- This model provides a unified view of users across all tenants\n\nwith all_users as (\n    select * from \"multitenant_analytics\".\"public\".\"stg_all_tenants__users\"\n),\n\nenriched_users as (\n    select\n        -- Primary key\n        concat(tenant_id, '_', user_id) as dim_user_key,\n        \n        -- User attributes\n        user_id,\n        tenant_id,\n        email,\n        first_name,\n        last_name,\n        concat(first_name, ' ', last_name) as full_name,\n        \n        -- Dates\n        registration_date,\n        last_login_date,\n        \n        -- Status and tier\n        account_status,\n        subscription_tier,\n        \n        -- Derived attributes\n        case \n            when account_status = 'ACTIVE' then 1 \n            else 0 \n        end as is_active,\n        \n        case \n            when subscription_tier = 'premium' then 1 \n            else 0 \n        end as is_premium,\n        \n        case \n            when last_login_date >= current_date - interval '30' day then 1 \n            else 0 \n        end as is_active_last_30_days,\n        \n        case \n            when last_login_date >= current_date - interval '7' day then 1 \n            else 0 \n        end as is_active_last_7_days,\n        \n        -- Tenure calculation (PostgreSQL syntax)\n        (current_date - registration_date) as days_since_registration,\n        \n        case \n            when (current_date - registration_date) <= 30 then 'New (0-30 days)'\n            when (current_date - registration_date) <= 90 then 'Growing (31-90 days)'\n            when (current_date - registration_date) <= 365 then 'Established (91-365 days)'\n            else 'Mature (365+ days)'\n        end as user_tenure_segment,\n        \n        -- Timestamps\n        created_at,\n        updated_at,\n        dbt_loaded_at,\n        current_timestamp as dim_created_at\n    from all_users\n)\n\nselect * from enriched_users", "relation_name": "\"multitenant_analytics\".\"public\".\"dim_users\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-19T10:22:10.999108Z", "completed_at": "2025-10-19T10:22:11.001637Z"}, {"name": "execute", "started_at": "2025-10-19T10:22:11.002058Z", "completed_at": "2025-10-19T10:22:11.030553Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03281855583190918, "adapter_response": {"_message": "SELECT 4", "code": "SELECT", "rows_affected": 4}, "message": "SELECT 4", "failures": null, "unique_id": "model.multitenant_analytics.fact_user_metrics", "compiled": true, "compiled_code": "\n\n-- Fact table for user metrics aggregated by tenant and date\n-- This model provides daily metrics for cross-tenant analytics and reporting\n\nwith daily_user_metrics as (\n    select\n        tenant_id,\n        date_trunc('day', dbt_loaded_at) as metric_date,\n        \n        -- User counts\n        count(*) as total_users,\n        count(case when account_status = 'ACTIVE' then 1 end) as active_users,\n        count(case when subscription_tier = 'premium' then 1 end) as premium_users,\n        count(case when subscription_tier = 'free' then 1 end) as free_users,\n        \n        -- Activity metrics  \n        count(case when last_login_date >= current_date - interval '7' day then 1 end) as active_users_7d,\n        count(case when last_login_date >= current_date - interval '30' day then 1 end) as active_users_30d,\n        \n        -- Registration metrics\n        count(case when registration_date = current_date then 1 end) as new_registrations_today,\n        count(case when registration_date >= current_date - interval '7' day then 1 end) as new_registrations_7d,\n        count(case when registration_date >= current_date - interval '30' day then 1 end) as new_registrations_30d,\n        \n        -- Tenure segments (PostgreSQL syntax)\n        count(case when (current_date - registration_date) <= 30 then 1 end) as users_new_segment,\n        count(case when (current_date - registration_date) between 31 and 90 then 1 end) as users_growing_segment,\n        count(case when (current_date - registration_date) between 91 and 365 then 1 end) as users_established_segment,\n        count(case when (current_date - registration_date) > 365 then 1 end) as users_mature_segment,\n        \n        -- Average metrics (PostgreSQL syntax)\n        avg(current_date - registration_date) as avg_user_tenure_days,\n        avg(case when last_login_date is not null then (current_date - last_login_date) end) as avg_days_since_last_login,\n        \n        current_timestamp as fact_created_at\n        \n    from \"multitenant_analytics\".\"public\".\"dim_users\"\n    group by \n        tenant_id,\n        date_trunc('day', dbt_loaded_at)\n),\n\ncross_tenant_metrics as (\n    select\n        'all_tenants' as tenant_id,\n        metric_date,\n        \n        -- Aggregated cross-tenant metrics\n        sum(total_users) as total_users,\n        sum(active_users) as active_users,\n        sum(premium_users) as premium_users,\n        sum(free_users) as free_users,\n        sum(active_users_7d) as active_users_7d,\n        sum(active_users_30d) as active_users_30d,\n        sum(new_registrations_today) as new_registrations_today,\n        sum(new_registrations_7d) as new_registrations_7d,\n        sum(new_registrations_30d) as new_registrations_30d,\n        sum(users_new_segment) as users_new_segment,\n        sum(users_growing_segment) as users_growing_segment,\n        sum(users_established_segment) as users_established_segment,\n        sum(users_mature_segment) as users_mature_segment,\n        \n        -- Weighted averages for cross-tenant metrics\n        sum(avg_user_tenure_days * total_users) / sum(total_users) as avg_user_tenure_days,\n        sum(avg_days_since_last_login * total_users) / sum(total_users) as avg_days_since_last_login,\n        \n        current_timestamp as fact_created_at\n        \n    from daily_user_metrics\n    group by metric_date\n),\n\ncombined_metrics as (\n    select * from daily_user_metrics\n    \n    union all\n    \n    select * from cross_tenant_metrics\n)\n\nselect \n    -- Generate surrogate key\n    concat(tenant_id, '_', cast(metric_date as text)) as fact_user_metrics_key,\n    *\nfrom combined_metrics\norder by tenant_id, metric_date desc", "relation_name": "\"multitenant_analytics\".\"public\".\"fact_user_metrics\""}], "elapsed_time": 0.3034684658050537, "args": {"target": "local", "log_path": "/usr/app/dbt/logs", "log_file_max_bytes": 10485760, "quiet": false, "enable_legacy_logger": false, "cache_selected_only": false, "populate_cache": true, "vars": {}, "invocation_command": "dbt run --profiles-dir . --profile multitenant_analytics --target local", "strict_mode": false, "select": [], "log_level_file": "debug", "show_resource_report": false, "use_colors": true, "require_explicit_package_overrides_for_builtin_materializations": false, "print": true, "printer_width": 80, "static_parser": true, "exclude": [], "version_check": true, "log_format": "default", "defer": false, "send_anonymous_usage_stats": true, "write_json": true, "profiles_dir": ".", "log_format_file": "debug", "macro_debugging": false, "project_dir": "/usr/app/dbt", "introspect": true, "partial_parse": true, "log_level": "info", "profile": "multitenant_analytics", "warn_error_options": {"include": [], "exclude": []}, "which": "run", "use_colors_file": true, "indirect_selection": "eager", "partial_parse_file_diff": true, "favor_state": false}}